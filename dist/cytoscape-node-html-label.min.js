!function(){"use strict";var t=function(t,e){if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var n,o=t.length>>>0,i=arguments[1],s=0;s<o;s++)if(n=t[s],e.call(i,n,s,t))return n},e=function(){function t(t,e){var n=t.node,o=t.baseClassName,i=t.position,s=void 0===i?null:i,a=t.data,r=void 0===a?null:a;this.updateParams(e),this._node=n,this._baseElementClassName=o,this.init(),r&&this.updateData(r),s&&this.updatePosition(s)}return t.prototype.updateParams=function(t){var e=t.tpl,n=void 0===e?function(){return""}:e,o=t.cssClass,i=void 0===o?null:o,s=t.halign,a=void 0===s?"center":s,r=t.valign,d=void 0===r?"center":r,c=t.halignBox,l=void 0===c?"center":c,u=t.valignBox,p=void 0===u?"center":u,h={top:-.5,left:-.5,center:0,right:.5,bottom:.5};this._align=[h[a],h[d],100*(h[l]-.5),100*(h[p]-.5)],this.cssClass=i,this.tpl=n},t.prototype.updateData=function(t){try{this._node.innerHTML=this.tpl(t)}catch(t){console.error(t)}},t.prototype.getNode=function(){return this._node},t.prototype.updatePosition=function(t){this._renderPosition(t)},t.prototype.init=function(){this._node.setAttribute("class",this._baseElementClassName),this.cssClass&&this.cssClass.length&&this._node.classList.add(this.cssClass)},t.prototype._renderPosition=function(t){var e=this._position,n=t.x+this._align[0]*t.w,o=t.y+this._align[1]*t.h;if(!e||e[0]!==n||e[1]!==o){this._position=[n,o];var i="translate("+this._align[2]+"%,"+this._align[3]+"%) "+("translate("+n.toFixed(2)+"px,"+o.toFixed(2)+"px) "),s=this._node.style;s.webkitTransform=i,s.msTransform=i,s.transform=i}},t}(),n=function(){function t(t){this._node=t,this._cssWrap="cy-node-html-"+ +new Date,this._cssElem=this._cssWrap+"__e",this.addCssToDocument(),this._node.className=this._cssWrap,this._elements={}}return t.prototype.addOrUpdateElem=function(t,n,o){void 0===o&&(o={});var i=this._elements[t];if(i)i.updateParams(n),i.updateData(o.data),i.updatePosition(o.position);else{var s=document.createElement("div");this._node.appendChild(s),this._elements[t]=new e({node:s,baseClassName:this._cssElem,data:o.data,position:o.position},n)}},t.prototype.removeElemById=function(t){this._elements[t]&&(this._node.removeChild(this._elements[t].getNode()),delete this._elements[t])},t.prototype.updateElemPosition=function(t,e){var n=this._elements[t];n&&n.updatePosition(e)},t.prototype.highlightElement=function(t){var e=this._elements[t];e&&(e.cssClass+="highlighted")},t.prototype.updatePanZoom=function(t){var e=t.pan,n=t.zoom,o="translate("+e.x+"px,"+e.y+"px) scale("+n+")",i=this._node.style,s="top left";i.webkitTransform=o,i.msTransform=o,i.transform=o,i.webkitTransformOrigin=s,i.msTransformOrigin=s,i.transformOrigin=s},t.prototype.addCssToDocument=function(){document.querySelector("head").innerHTML+="<style>."+this._cssWrap+"{position:absolute;z-index:10;width:500px;pointer-events:none;margin:0;padding:0;border:0;outline:0} ."+this._cssElem+"{position:absolute}</style>"},t}();function o(e,o){var i=o&&"object"==typeof o?o:[],s=function(){var t=e.container(),o=document.createElement("div"),i=t.querySelector("canvas"),s=t.querySelector('[class^="cy-node-html"]');s&&i.parentNode.removeChild(s);return i.parentNode.appendChild(o),new n(o)}();return e.one("render",function(t){var e;e=t.cy,i.forEach(function(t){e.elements(t.query).forEach(function(e){e.isNode()&&s.addOrUpdateElem(e.id(),t,{position:r(e),data:e.data()})})}),a(t)}),e.on("add",function(e){var n=e.target,o=t(i.slice().reverse(),function(t){return n.is(t.query)});o&&s.addOrUpdateElem(n.id(),o,{position:r(n),data:n.data()})}),e.on("layoutstop",function(t){var e=t.cy;i.forEach(function(t){e.elements(t.query).forEach(function(t){t.isNode()&&s.updateElemPosition(t.id(),r(t))})})}),e.on("remove",function(t){s.removeElemById(t.target.id())}),e.on("tapend",function(t){}),e.on("tapstart",function(t){s.highlightElement(t.target.id())}),e.on("data",function(e){setTimeout(function(){var n=e.target,o=t(i.slice().reverse(),function(t){return n.is(t.query)});o?s.addOrUpdateElem(n.id(),o,{position:r(n),data:n.data()}):s.removeElemById(n.id())},0)}),e.on("pan zoom",a),e.on("drag",function(t){s.updateElemPosition(t.target.id(),r(t.target))}),e;function a(t){var e=t.cy;s.updatePanZoom({pan:e.pan(),zoom:e.zoom()})}function r(t){return{w:t.width(),h:t.height(),x:t.position("x"),y:t.position("y")}}}var i=function(t){t&&t("core","nodeHtmlLabel",function(t){return o(this,t)})};"undefined"!=typeof module&&module.exports?module.exports=function(t){i(t)}:"undefined"!=typeof define&&define.amd&&define("cytoscape-nodeHtmlLabel",function(){return i}),"undefined"!=typeof cytoscape&&i(cytoscape)}();